<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-dark.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>Mail-tracker by jdavidbakr</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>Mail-tracker</h1>
          <h2>Package for Laravel to inject tracking code into outgoing emails.</h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/jdavidbakr/mail-tracker/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/jdavidbakr/mail-tracker/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/jdavidbakr/mail-tracker" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <h1>
<a id="mailtracker" class="anchor" href="#mailtracker" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>MailTracker</h1>

<p><a href="https://packagist.org/packages/jdavidbakr/mail-tracker"><img src="https://img.shields.io/packagist/v/jdavidbakr/mail-tracker.svg?style=flat-square" alt="Latest Version on Packagist"></a>
<a href="LICENSE.md"><img src="https://img.shields.io/badge/license-MIT-brightgreen.svg?style=flat-square" alt="Software License"></a>
<a href="https://packagist.org/packages/jdavidbakr/mail-tracker"><img src="https://img.shields.io/packagist/dt/jdavidbakr/mail-tracker.svg?style=flat-square" alt="Total Downloads"></a></p>

<p>MailTracker will hook into all outgoing emails from Laravel/Lumen and inject a tracking code into it.  It will also store the rendered email in the database.  There is also an interface to view sent emails.</p>

<h2>
<a id="note-for-laravel--5323-you-must-use-version-20-or-earlier" class="anchor" href="#note-for-laravel--5323-you-must-use-version-20-or-earlier" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>NOTE: For Laravel &lt; 5.3.23 you MUST use version 2.0 or earlier.</h2>

<h2>
<a id="upgrade-from-20-or-earlier" class="anchor" href="#upgrade-from-20-or-earlier" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Upgrade from 2.0 or earlier</h2>

<p>First, upgrade to version 2.1 by running:</p>

<div class="highlight highlight-source-shell"><pre>$ composer require jdavidbakr/mail-tracker <span class="pl-k">~</span>2.1</pre></div>

<p>If you are updating from an earlier version, you will need to update the config file and run the new migrations.  For best results, make a backup copy of config/mail-tracker.php and the views in resources/views/vendor/emailTrackingViews (if they exists) to restore any values you have customized, then delete that file and run</p>

<div class="highlight highlight-source-shell"><pre>$ php artisan vendor:publish
$ php artisan migrate</pre></div>

<h2>
<a id="install-laravel" class="anchor" href="#install-laravel" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install (Laravel)</h2>

<p>Via Composer</p>

<div class="highlight highlight-source-shell"><pre>$ composer require jdavidbakr/mail-tracker <span class="pl-k">~</span>2.1</pre></div>

<p>Add the following to the providers array in config/app.php:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c1">jdavidbakr\MailTracker\</span><span class="pl-c1">MailTrackerServiceProvider</span><span class="pl-k">::</span><span class="pl-c1">class</span>,</span></pre></div>

<p>Publish the config file and migration</p>

<div class="highlight highlight-source-shell"><pre>$ php artisan vendor:publish --provider=<span class="pl-s"><span class="pl-pds">'</span>jdavidbakr\MailTracker\MailTrackerServiceProvider<span class="pl-pds">'</span></span></pre></div>

<p>Run the migration</p>

<div class="highlight highlight-source-shell"><pre>$ php artisan migrate</pre></div>

<h2>
<a id="install-lumen" class="anchor" href="#install-lumen" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install (Lumen)</h2>

<p>Via Composer</p>

<div class="highlight highlight-source-shell"><pre>$ composer require jdavidbakr/mail-tracker <span class="pl-k">~</span>2.1</pre></div>

<p>Register the following service provider in bootstrap/app.php</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c1">jdavidbakr\MailTracker\</span><span class="pl-c1">MailTrackerServiceProvider</span><span class="pl-k">::</span><span class="pl-c1">class</span></span></pre></div>

<p>Copy vendor/jdavidbakr/mail-tracker/migrations/2016_03_01_193027_create_sent_emails_table.php and vendor/jdavidbakr/mail-tracker/config/mail-tracker.php to your respective migrations and config folders. You may have to create a config folder if it doesn't already exist.</p>

<p>Run the migration</p>

<div class="highlight highlight-source-shell"><pre>$ php artisan migrate</pre></div>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>

<p>Once installed, all outgoing mail will be logged to the database.  The following config options are available in config/mail-tracker.php:</p>

<ul>
<li>
<strong>name</strong>: set your App Name.</li>
<li>
<strong>inject-pixel</strong>: set to true to inject a tracking pixel into all outgoing html emails.</li>
<li>
<strong>track-links</strong>: set to true to rewrite all anchor href links to include a tracking link. The link will take the user back to your website which will then redirect them to the final destination after logging the click.</li>
<li>
<strong>expire-days</strong>: How long in days that an email should be retained in your database.  If you are sending a lot of mail, you probably want it to eventually expire.  Set it to zero to never purge old emails from the database.</li>
<li>
<strong>route</strong>: The route information for the tracking URLs.  Set the prefix and middlware as desired.</li>
<li>
<strong>admin-route</strong>: The route information for the admin.  Set the prefix and middleware.</li>
<li>
<strong>admin-template</strong>: The params for the Admin Panel and Views. You can integrate your existing Admin Panel with the MailTracker admin panel.</li>
<li>
<strong>date-format</strong>: You can define the format to show dates in the Admin Panel.</li>
</ul>

<h2>
<a id="events" class="anchor" href="#events" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Events</h2>

<p>When an email is sent, viewed, or a link is clicked, its tracking information is counted in the database using the jdavidbark\MailTracker\Model\SentEmail model. You may want to do additional processing on these events, so an event is fired in these cases:</p>

<ul>
<li>jdavidbakr\MailTracker\Events\EmailSentEvent</li>
<li>jdavidbakr\MailTracker\Events\ViewEmailEvent</li>
<li>jdavidbakr\MailTracker\Events\LinkClickedEvent</li>
</ul>

<p>If you are using the Amazon SNS notification system, an event is fired when you receive a permanent bounce.  You may want to mark the email as bad or remove it from your database.</p>

<ul>
<li>jdavidbakr\MailTracker\Events\PermanentBouncedMessageEvent</li>
</ul>

<p>To install an event listener, you will want to create a file like the following:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">App\Listeners</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">jdavidbakr\MailTracker\Events\ViewEmailEvent</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">EmailViewed</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">     * Create the event listener.</span></span>
<span class="pl-s1"><span class="pl-c">     *</span></span>
<span class="pl-s1"><span class="pl-c">     * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">     */</span></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-c1">__construct</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-c">//</span></span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">     * Handle the event.</span></span>
<span class="pl-s1"><span class="pl-c">     *</span></span>
<span class="pl-s1"><span class="pl-c">     * <span class="pl-k">@param</span>  ViewEmailEvent  $event</span></span>
<span class="pl-s1"><span class="pl-c">     * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">     */</span></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">handle</span>(<span class="pl-c1">ViewEmailEvent</span> <span class="pl-smi">$event</span>)</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-c">// Access the model using $event-&gt;sent_email...</span></span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span></pre></div>

<div class="highlight highlight-text-html-php"><pre><span class="pl-pse">&lt;?php</span><span class="pl-s1"></span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">namespace</span> <span class="pl-en">App\Listeners</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">use</span> <span class="pl-c1">jdavidbakr\MailTracker\Events\PermanentBouncedMessageEvent</span>;</span>
<span class="pl-s1"></span>
<span class="pl-s1"><span class="pl-k">class</span> <span class="pl-en">BouncedEmail</span></span>
<span class="pl-s1">{</span>
<span class="pl-s1">    <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">     * Create the event listener.</span></span>
<span class="pl-s1"><span class="pl-c">     *</span></span>
<span class="pl-s1"><span class="pl-c">     * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">     */</span></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-c1">__construct</span>()</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-c">//</span></span>
<span class="pl-s1">    }</span>
<span class="pl-s1"></span>
<span class="pl-s1">    <span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c">     * Handle the event.</span></span>
<span class="pl-s1"><span class="pl-c">     *</span></span>
<span class="pl-s1"><span class="pl-c">     * <span class="pl-k">@param</span>  PermanentBouncedMessageEvent  $event</span></span>
<span class="pl-s1"><span class="pl-c">     * <span class="pl-k">@return</span> void</span></span>
<span class="pl-s1"><span class="pl-c">     */</span></span>
<span class="pl-s1">    <span class="pl-k">public</span> <span class="pl-k">function</span> <span class="pl-en">handle</span>(<span class="pl-c1">PermanentBouncedMessageEvent</span> <span class="pl-smi">$event</span>)</span>
<span class="pl-s1">    {</span>
<span class="pl-s1">        <span class="pl-c">// Access the email address using $event-&gt;email_address...</span></span>
<span class="pl-s1">    }</span>
<span class="pl-s1">}</span></pre></div>

<p>Then you must register the event in your \App\Providers\EventServiceProvider $listen array:</p>

<div class="highlight highlight-text-html-php"><pre><span class="pl-s1"><span class="pl-c">/**</span></span>
<span class="pl-s1"><span class="pl-c"> * The event listener mappings for the application.</span></span>
<span class="pl-s1"><span class="pl-c"> *</span></span>
<span class="pl-s1"><span class="pl-c"> * <span class="pl-k">@var</span> array</span></span>
<span class="pl-s1"><span class="pl-c"> */</span></span>
<span class="pl-s1"><span class="pl-k">protected</span> <span class="pl-smi">$listen</span> <span class="pl-k">=</span> [</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>jdavidbakr\MailTracker\Events\ViewEmailEvent<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>App\Listeners\EmailViewed<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">    ],</span>
<span class="pl-s1">    <span class="pl-s"><span class="pl-pds">'</span>jdavidbakr\MailTracker\Events\PermanentBouncedMessageEvent<span class="pl-pds">'</span></span> <span class="pl-k">=&gt;</span> [</span>
<span class="pl-s1">        <span class="pl-s"><span class="pl-pds">'</span>App\Listeners\BouncedEmail<span class="pl-pds">'</span></span>,</span>
<span class="pl-s1">    ],</span>
<span class="pl-s1">];</span></pre></div>

<h2>
<a id="amazon-ses-features" class="anchor" href="#amazon-ses-features" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Amazon SES features</h2>

<p>If you use Amazon SES, you can add some additional information to your tracking.  To set up the SES callbacks, first set up SES notifications under your domain in the SES control panel.  Then subscribe to the topic by going to the admin panel of the notification topic and creating a subscription for the URL you copied from the admin page.  The system should immediately respond to the subscription request.  If you like, you can use multiple subscriptions (i.e. one for delivery, one for bounces).  See above for events that are fired on a failed message.</p>

<h2>
<a id="views" class="anchor" href="#views" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Views</h2>

<p>When you do the php artisan vendor:publish simple views will add to your resources/views/vendor/emailTrakingViews and you can customize.</p>

<h2>
<a id="admin-panel" class="anchor" href="#admin-panel" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Admin Panel</h2>

<p>Config your admin-route in the config file. Set the prefix and middlware.
The route name is 'mailTracker_Index'. The standard admin panel route is located at /email-manager.
You can use route names to include them into your existing admin menu.
You can customize your route in the config file.
You can see all sent emails, total opens, total urls clicks, show individuals emails and show the urls clicked details.
All views (email tamplates, panel) can be customized in resources/views/vendor/emailTrakingViews.</p>

<h2>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Contributing</h2>

<p>Please see <a href="CONTRIBUTING.md">CONTRIBUTING</a> and <a href="CONDUCT.md">CONDUCT</a> for details.</p>

<h2>
<a id="security" class="anchor" href="#security" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Security</h2>

<p>If you discover any security related issues, please email <a href="mailto:me@jdavidbaker.com">me@jdavidbaker.com</a> instead of using the issue tracker.</p>

<h2>
<a id="credits" class="anchor" href="#credits" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Credits</h2>

<ul>
<li><a href="https://github.com/jdavidbakr">J David Baker</a></li>
<li><a href="../../contributors">All Contributors</a></li>
</ul>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>License</h2>

<p>The MIT License (MIT). Please see <a href="LICENSE.md">License File</a> for more information.</p>
        </section>

        <footer>
          Mail-tracker is maintained by <a href="https://github.com/jdavidbakr">jdavidbakr</a><br>
          This page was generated by <a href="https://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>
